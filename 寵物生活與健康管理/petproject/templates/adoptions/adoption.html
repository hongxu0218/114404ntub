{% extends 'base.html' %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/adoptions.css' %}?v=7">
{% endblock %}

{% block content %}
<style>
  :root {
    --card-bg: #fffdf8;
    --card-hover: #fff5e6;
    --border-color: #ffcc80;
    --orange-accent: #ffb84d;
    --text-main: #333;
    --text-muted: #999;
    --shadow-soft: rgba(0, 0, 0, 0.1);
  }

/* 響應式調整 */
  @media (max-width: 480px) {
    .col {
      max-width: 320px; /* 限制最大寬度 */
      margin: 0 auto;   /* 置中 */4
    }
    .card {
      width: 100%; /* 讓卡片撐滿 col */
    }
}
@media (max-width: 768px) {
  .card-title {
    font-size: 1.1rem;
  }
  .card-text {
    font-size: 0.9rem;
  }
  .pet-tracks img {
    width: 22px;
    height: 22px;
  }
}

/* 「刊登」按鈕樣式 */
.btn-publish {
  background-color: #FFF8F0;
  color: #278080;
  border-color: #278080;
  border-radius: 10px;
  font-weight: bold;
  font-size: 1.1rem;           /* 字體稍微變大 */
  padding: 0.7rem 1.5rem;      /* 更大的上下/左右內距 */
  box-shadow: 0 3px 6px rgba(0, 0, 0, 0.15);
  transition: background-color 0.2s ease, box-shadow 0.2s ease;
}

.btn-publish:hover {
  background-color: #278080;
  color: white;
}
.btn-publish:active {
  background-color: #194f4f !important;
  color: white !important;
  border-color: #194f4f !important;
}


.btn-search {
  background-color: var(--orange-accent);
  color: white;
  font-weight: bold;
  border: none;
  padding: 0.5rem 1.2rem;
  border-radius: 25px;
  box-shadow: 0 2px 4px var(--shadow-soft);
  transition: background-color 0.3s ease, box-shadow 0.3s ease;
}

.btn-search:hover {
  background-color: #ffa726; /* 深一點的橘色 */
  box-shadow: 0 4px 6px var(--shadow-soft);
}
.search-bar {
  background-color: none; /* 橘色系偏深背景，可改 */
  border: none;
  border-radius: 20px;
  box-shadow: 0 2px 4px var(--shadow-soft);
}
/* 搜索欄位的長度 */
.col-md-auto{
  width: 12.5%;
 }
/* 通用按鈕樣式 */
.btn-toggle-order {
  width: 42px;
  height: 42px;
  padding: 0;
  border-radius: 50%;
  border: 2px solid #D2CBC4;
  background-color: white;
  color: #D2CBC4;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s ease;
}

/* hover 效果：顏色反轉 */
.btn-toggle-order:hover {
  background-color: #D2CBC4;
  color: white;
}

/* 若是最早排序中，反轉顏色（讓按鈕維持反轉狀態） */
.btn-toggle-order.active {
  background-color: #D2CBC4;
  color: white;
  border-color: white;
}

/* icon 旋轉 */
.rotate-180 {
  display: inline-block;
  transform: rotate(180deg) scaleX(-1);
  transition: transform 0.3s ease;
}



</style>



<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2><img src="{% static 'images/icon-adoption.png' %}" alt="領養圖示" class="icon-adoption-adopt"> 領養專區</h2>
    <a href="{% url 'my_adoption' %}" class="btn btn-publish"><i class="bi-pencil-square me-1"></i>
      我要刊登</a>
    <a href="{% url 'add_adoptpet' %}" class="add-btn text-decoration-none"> 新增測試 </a>
  </div>
<form method="get" class="mb-4 search-bar rounded px-3 py-3">
  <div class="row g-2">

    <div class="col-md-2">
      <input type="text" name="keyword" class="form-control" placeholder="輸入關鍵字" value="{{ request.GET.keyword }}">
    </div>

    <div class="col-md-auto">
      <select name="adopt_place" class="form-select">
        <option value="">不限地區</option>
        <option value="north" {% if request.GET.adopt_place == "north" %}selected{% endif %}>北部地區</option>
        <option value="central" {% if request.GET.adopt_place == "central" %}selected{% endif %}>中部地區</option>
        <option value="south" {% if request.GET.adopt_place == "south" %}selected{% endif %}>南部地區</option>
        <option value="east" {% if request.GET.adopt_place == "east" %}selected{% endif %}>東部地區</option>
        <option value="island" {% if request.GET.adopt_place == "island" %}selected{% endif %}>離島地區</option>
      </select>
    </div>

    <div class="col-md-auto">
      <select id="species" name="species" class="form-select">
        <option value="">不限種類</option>
        <option value="dog" {% if request.GET.species == "dog" %}selected{% endif %}>狗</option>
        <option value="cat" {% if request.GET.species == "cat" %}selected{% endif %}>貓</option>
        <option value="other" {% if request.GET.species == "other" %}selected{% endif %}>其他</option>
      </select>
    </div>

    <div class="col-md-auto">
      <select id="gender" name="gender" class="form-select">
        <option value="">不限性別</option>
        <option value="male" {% if request.GET.gender == "male" %}selected{% endif %}>公</option>
        <option value="female" {% if request.GET.gender == "female" %}selected{% endif %}>母</option>
      </select>
    </div>

    <div class="col-md-auto">
      <select id="age_group" name="age_group" class="form-select">
        <option value="">不限年齡</option>
        <option value="0-1" {% if request.GET.age_group == "0-1" %}selected{% endif %}>幼年 (0-1)</option>
        <option value="1-3" {% if request.GET.age_group == "1-3" %}selected{% endif %}>青年 (1-3)</option>
        <option value="3-6" {% if request.GET.age_group == "3-6" %}selected{% endif %}>壯年 (3-6)</option>
        <option value="6+" {% if request.GET.age_group == "6+" %}selected{% endif %}>老年 (6+)</option>
      </select>
    </div>

    <div class="col-md-auto">
      <select id="is_sterilizated" name="is_sterilizated" class="form-select">
        <option value="">不限絕育狀態</option>
        <option value="sterilized" {% if request.GET.is_sterilizated == "sterilized" %}selected{% endif %}>已絕育</option>
        <option value="not_sterilized" {% if request.GET.is_sterilizated == "not_sterilized" %}selected{% endif %}>未絕育</option>
      </select>
    </div>

    <div class="col-md-2 d-flex align-items-end">
      <button type="submit" class="btn-search">
        <i class="bi bi-search me-1"></i> 搜尋
      </button>
    </div>
    {% comment %} 取得目前的參數，但排除原本的 order 參數 {% endcomment %}
    {% with request.GET.urlencode as current_query %}
      {% with current_query|cut:"order=oldest"|cut:"order=newest" as clean_query %}

        {% if request.GET.order == "oldest" %}
          <a href="?{{ clean_query }}&order=newest" class="btn btn-toggle-order active" title="切換為最新">
            <i class="bi bi-arrow-down-up"></i>
          </a>
        {% else %}
          <a href="?{{ clean_query }}&order=oldest" class="btn btn-toggle-order" title="切換為最早">
            <i class="bi bi-arrow-down-up rotate-180 "></i>
          </a>
        {% endif %}


      {% endwith %}
    {% endwith %}

  </div>
</form>

  {% if adoptions %}
    <div class="row row-cols-1 row-cols-md-4 g-4">
      {% for adoption in adoptions %}
        <div class="col">
          <div class="card h-110 shadow-sm">
            <a href="{% url 'adoption_petDetail' adoption.id %}" class="text-decoration-none text-dark">
              {% if adoption.adopt_picture1 %}
                <img src="{{ adoption.adopt_picture1.url }}" class="card-img-top" alt="{{ adoption.name }}">
              {% else %}
                <img src="{% static 'default_pet.jpg' %}" class="card-img-top" alt="預設圖片">
              {% endif %}
              <div class="card-body">
                <h5 class="card-title">{{ adoption.name }}
                  <p class="card-text">
                      <span class="me-3">
                        <i class="bi bi-gender-ambiguous me-1"></i>{{ adoption.get_gender_display|default:"無" }}
                      </span>
                      <span class="me-3">
                        <i class="bi bi-calendar-heart me-1"></i>{{ adoption.age|default:"未知" }}
                      </span>
                      <span>
                        <i class="bi bi-tag me-1"></i>
                        {% if adoption.parsed_breed.breed_choice %}
                        {% if adoption.parsed_breed.breed_choice == "其他" %}
                          <span>{{ adoption.parsed_breed.breed_other }}</span>
                        {% else %}
                          <span>{{ adoption.parsed_breed.breed_choice }}</span>
                        {% endif %}
                      {% else %}
                        <span class="badge bg-light text-muted" style="font-size: 14px;">尚無資料</span>
                      {% endif %}
                      </span>
                    </p>

                </h5>
                <p class="card-text">
                  <strong style="color : grey;">個性特徵：</strong>
                  <span class="feature-limit">
                    {% if adoption.parsed_feature.feature_choice %}
                      {% if adoption.parsed_feature.feature_choice == "其他" %}
                        <span class="badge text-dark" style="font-size: 14px;" >{{ adoption.parsed_feature.feature_other }}</span>
                      {% else %}
                        <span class="badge text-dark" style="font-size: 14px;" >{{ adoption.parsed_feature.feature_choice }}</span>
                      {% endif %}
                    {% else %}
                      <span class="badge bg-light text-muted" style="font-size: 14px;">尚無資料</span>
                    {% endif %}
                  </span><br>
                </p>

              </div>
              <div class="card-footer">
                <span class="posted-date">{{ adoption.posted_date|date:"Y-m-d" }}</span>
              </div>
            </a>
          </div>

        </div>
      {% endfor %}
    </div>
  {% else %}
    {% if request.GET %}
      <div class="alert alert-warning mt-3">
        找不到符合條件的寵物，請嘗試其他搜尋條件。
      </div>
    {% else %}
      <p>目前沒有待領養的寵物。</p>
    {% endif %}
  {% endif %}
</div>
{% endblock %}

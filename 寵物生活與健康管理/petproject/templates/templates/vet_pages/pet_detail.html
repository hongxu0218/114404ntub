
{% extends "vet_pages/base.html" %}

{% block title %}{{ pet.name }} çš„é†«ç™‚ç´€éŒ„{% endblock %}

{% block back_button %}
  <a href="{% url 'my_patients' %}" class="back-home">â† è¿”å›æˆ‘çš„çœ‹è¨ºå¯µç‰©</a>
{% endblock %}

{% block header %}
  <h1 class="section-title">ğŸ¾ {{ pet.name }} çš„é†«ç™‚ç´€éŒ„</h1>
{% endblock %}

{% block extra_css %}
<style>
  .record-card {
    background-color: #f9f9f9;
    border: 2px solid #cce5ff;
    padding: 16px;
    margin-bottom: 15px;
    border-radius: 10px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.06);
    transition: all 0.3s ease-in-out;
  }
  .record-card:hover {
    background-color: #e9f7ff;
    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.08);
  }
</style>
{% endblock %}

{% block content %}
<div class="pet-card">

  <h3>é£¼ä¸»ï¼š{{ pet.owner.last_name }}{{ pet.owner.first_name|default:pet.owner.username }}</h3>

  <!-- ç—…ä¾‹ç´€éŒ„ -->
  <h4>ç—…ä¾‹ç´€éŒ„</h4>
  {% if medical_records %}
    {% for record in medical_records %}
      <div class="record-card medical-record" {% if forloop.counter > 1 %}style="display: none;"{% endif %}>
        <p><strong>ğŸ—•ï¸ çœ‹è¨ºæ—¥æœŸï¼š</strong>{{ record.visit_date }}</p>
        <p><strong>ğŸ¥ çœ‹è¨ºåœ°é»ï¼š</strong>{{ record.clinic_location }}</p>
        <p><strong>ğŸ¦  è¨ºæ–·çµæœï¼š</strong>{{ record.diagnosis|default:"æœªå¡«å¯«" }}</p>
        <p><strong>ğŸ’Š æ²»ç™‚å…§å®¹ï¼š</strong>{{ record.treatment|default:"æœªå¡«å¯«" }}</p>
        <p><strong>ğŸ‘¨â€âš•ï¸ çœ‹è¨ºç¸é†«ï¼š</strong>{{ record.vet.user.last_name }}{{ record.vet.user.first_name }}</p>
      </div>
    {% endfor %}
    {% if medical_records|length > 1 %}
      <button onclick="toggleRecords('medical-record', this)" class="btn btn-secondary">é¡¯ç¤ºæ›´å¤šç—…ä¾‹ç´€éŒ„</button>
    {% endif %}
  {% else %}
    <p>ç„¡ç—…ä¾‹ç´€éŒ„</p>
  {% endif %}

  <!-- ç–«è‹—ç´€éŒ„ -->
  <h4>ç–«è‹—ç´€éŒ„</h4>
  {% if vaccine_records %}
    {% for record in vaccine_records %}
      <div class="record-card vaccine-record" {% if forloop.counter > 1 %}style="display: none;"{% endif %}>
        <p><strong>ğŸ’‰ ç–«è‹—å“ç‰Œï¼š</strong>{{ record.name }}</p>
        <p><strong>ğŸ“… æ–½æ‰“æ—¥æœŸï¼š</strong>{{ record.date }}</p>
        <p><strong>ğŸ“ æ–½æ‰“åœ°é»ï¼š</strong>{{ record.location }}</p>
        <p><strong>ğŸ‘¨â€âš•ï¸ æ–½æ‰“ç¸é†«ï¼š</strong>{{ record.vet.user.last_name }}{{ record.vet.user.first_name }}</p>
      </div>
    {% endfor %}
    {% if vaccine_records|length > 1 %}
      <button onclick="toggleRecords('vaccine-record', this)" class="btn btn-secondary">é¡¯ç¤ºæ›´å¤šç–«è‹—ç´€éŒ„</button>
    {% endif %}
  {% else %}
    <p>ç„¡ç–«è‹—ç´€éŒ„</p>
  {% endif %}

  <!-- é©…èŸ²ç´€éŒ„ -->
  <h4>é©…èŸ²ç´€éŒ„</h4>
  {% if deworm_records %}
    {% for record in deworm_records %}
      <div class="record-card deworm-record" {% if forloop.counter > 1 %}style="display: none;"{% endif %}>
        <p><strong>ğŸª² é©…èŸ²å“ç‰Œï¼š</strong>{{ record.name }}</p>
        <p><strong>ğŸ“… æ–½æ‰“æ—¥æœŸï¼š</strong>{{ record.date }}</p>
        <p><strong>ğŸ“ æ–½æ‰“åœ°é»ï¼š</strong>{{ record.location }}</p>
        <p><strong>ğŸ‘¨â€âš•ï¸ æ–½æ‰“ç¸é†«ï¼š</strong>{{ record.vet.user.last_name }}{{ record.vet.user.first_name }}</p>
      </div>
    {% endfor %}
    {% if deworm_records|length > 1 %}
      <button onclick="toggleRecords('deworm-record', this)" class="btn btn-secondary">é¡¯ç¤ºæ›´å¤šé©…èŸ²ç´€éŒ„</button>
    {% endif %}
  {% else %}
    <p>ç„¡é©…èŸ²ç´€éŒ„</p>
  {% endif %}

  <!-- å ±å‘Š -->
  <h4>å ±å‘Š</h4>
  {% if reports %}
    {% for report in reports %}
      <div class="record-card report-record" {% if forloop.counter > 1 %}style="display: none;"{% endif %}>
        <p><strong>ğŸ“„ æ¨™é¡Œï¼š</strong>{{ report.title }}</p>
        <p><strong>ğŸ“ æª”æ¡ˆï¼š</strong><a href="{{ report.pdf.url }}" target="_blank">{{ report.pdf.name|default:"æŸ¥çœ‹æª”æ¡ˆ" }}</a></p>
      </div>
    {% endfor %}
    {% if reports|length > 1 %}
      <button onclick="toggleRecords('report-record', this)" class="btn btn-secondary">é¡¯ç¤ºæ›´å¤šå ±å‘Š</button>
    {% endif %}
  {% else %}
    <p>ç„¡å ±å‘Š</p>
  {% endif %}

</div>

<!-- é€šç”¨å±•é–‹/æ”¶åˆ JS -->
<script>
  function toggleRecords(className, button) {
    const elements = document.querySelectorAll(`.${className}`);
    const isHidden = elements[1].style.display === 'none';
    elements.forEach((el, index) => {
      if (index > 0) el.style.display = isHidden ? 'block' : 'none';
    });
    button.textContent = isHidden ? 'éš±è—' + button.textContent.replace('é¡¯ç¤ºæ›´å¤š', '') : 'é¡¯ç¤ºæ›´å¤š' + button.textContent.replace('éš±è—', '');
  }
</script>
{% endblock %}

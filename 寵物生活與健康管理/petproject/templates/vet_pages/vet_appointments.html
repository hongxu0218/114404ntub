{% extends "vet_pages/base.html" %}

{% block title %}å·²è¢«é ç´„æ™‚æ®µ{% endblock %}

{% block back_button %}
<a href="{% url 'vet_home' %}" class="back-home">â† è¿”å›ä¸»æ§å°</a>
{% endblock %}

{% block header %}
<h1>ğŸ“… å·²è¢«é ç´„çš„æ™‚æ®µ</h1>
{% endblock %}

{% block content %}
<style>
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
  }
  th, td {
    padding: 12px;
    border: 1px solid #dee2e6;
    text-align: center;
  }
  th {
    background-color: #007bff;
    color: white;
  }
  tr:nth-child(even) {
    background-color: #f2f2f2;
  }
</style>

<div style="margin-bottom: 20px;">
  {% if show_history %}
      <a href="{% url 'vet_appointments' %}" class="btn btn-primary">ğŸ”™ è¿”å›æœªçœ‹è¨ºæ™‚æ®µ</a>
  {% else %}
      <a href="{% url 'vet_appointments' %}?history=1" class="btn btn-secondary">ğŸ“œ æŸ¥çœ‹å·²çœ‹è¨ºç´€éŒ„</a>
  {% endif %}
</div>

<table>
  <thead>
    <tr>
      <th>æ—¥æœŸ</th>
      <th>æ™‚é–“</th>
      <th>å¯µç‰©åç¨±</th>
      <th>é£¼ä¸»</th>
      <th>é ç´„åŸå› </th>
      {% if not show_history %}
        <th>æ“ä½œ</th>
      {% endif %}
    </tr>
  </thead>
  <tbody>
    {% regroup appointments by date as date_groups %}
    {% for group in date_groups %}
      <tr>
        <td colspan="6" style="background-color: #d1ecf1; font-weight: bold;">
          ğŸ“… {{ group.grouper }}ï¼ˆ{{ group.grouper|date:"l" }}ï¼‰
        </td>
      </tr>
      {% for appt in group.list %}
        <tr>
          <td>{{ appt.date }}</td>
          <td>{{ appt.time }}</td>
          <td><a href="{% url 'vet_pet_detail' appt.pet.id %}">{{ appt.pet.name }}</a></td>
          <td>
            {% if appt.owner.last_name or appt.owner.first_name %}
              {{ appt.owner.last_name }}{{ appt.owner.first_name }}
            {% else %}
              {{ appt.owner.username }}
            {% endif %}
          </td>
          <td>{{ appt.reason }}</td>
          {% if not show_history %}
          <td>
            <form method="POST" action="{% url 'vet_cancel_appointment' appt.id %}" onsubmit="return confirm('ç¢ºå®šè¦å–æ¶ˆé€™ç­†é ç´„å—ï¼Ÿ');" style="display: flex; align-items: center; gap: 8px;">
              {% csrf_token %}
              <input type="text" name="cancel_reason" placeholder="å–æ¶ˆåŸå› " required
                style="width: 120px; padding: 4px; font-size: 14px;">
              <button type="submit" style="padding: 6px 12px; background-color: #dc3545; color: white; border: none; border-radius: 4px;">å–æ¶ˆ</button>
            </form>
            <a href="{% url 'create_medical_record' appt.pet.id %}" style="
              display: inline-block;
              width: 120px;
              height: 34px;
              line-height: 34px;
              text-align: center;
              margin-top: 6px;
              background-color: #28a745;
              color: white;
              text-decoration: none;
              border-radius: 4px;
              font-size: 14px;
            ">æ–°å¢ç—…æ­·</a>
          </td>
          {% endif %}
        </tr>
      {% endfor %}
    {% empty %}
      <tr>
        <td colspan="6">ç›®å‰å°šç„¡é ç´„</td>
      </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}

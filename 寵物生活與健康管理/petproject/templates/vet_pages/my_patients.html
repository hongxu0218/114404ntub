
{% extends "vet_pages/base.html" %}

{% block title %}æˆ‘çš„çœ‹è¨ºå¯µç‰©{% endblock %}

{% block back_button %}
  <a href="{% url 'vet_home' %}" class="back-home">â† å›ä¸»æ§å°</a>
{% endblock %}

{% block header %}<h1 class="section-title">ğŸ¾ æˆ‘çš„çœ‹è¨ºå¯µç‰©</h1>{% endblock %}

{% block extra_css %}
<style>
  .record-card {
    background-color: #f9f9f9;
    border: 2px solid #cce5ff;
    padding: 16px;
    margin-bottom: 15px;
    border-radius: 10px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.06);
    transition: all 0.3s ease-in-out;
  }
  .record-card:hover {
    background-color: #e9f7ff;
    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.08);
  }
  .record-more { display: none; }
  .pet-header {
    cursor: pointer;
    background-color: #eef6ff;
    padding: 10px 14px;
    margin: 15px 0;
    border-radius: 8px;
    font-size: 18px;
    font-weight: bold;
  }

  .add-buttons {
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    margin-bottom: 15px;
  }
  .add-buttons .btn {
    padding: 8px 14px;
    border-radius: 20px;
    font-size: 14px;
    font-weight: bold;
    color: white;
    text-decoration: none;
    transition: background-color 0.3s ease;
  }
  .btn-medical { background-color: #4db6ac; }
  .btn-medical:hover { background-color: #009688; }

  .btn-vaccine { background-color: #42a5f5; }
  .btn-vaccine:hover { background-color: #1e88e5; }

  .btn-deworm { background-color: #ab47bc; }
  .btn-deworm:hover { background-color: #8e24aa; }

  .btn-report { background-color: #ef5350; }
  .btn-report:hover { background-color: #e53935; }

  .search-container {
    display: flex;
    gap: 10px;
    margin: 20px 0;
    flex-wrap: wrap;
  }
  .search-container input[type="text"] {
    flex: 1;
    min-width: 200px;
    padding: 8px 14px;
    border: 2px solid #90caf9;
    border-radius: 20px;
    font-size: 15px;
    outline: none;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    transition: border-color 0.3s ease;
  }
  .search-container input[type="text"]:focus {
    border-color: #42a5f5;
  }
  .btn-search {
    background-color: #42a5f5;
    color: white;
    border-radius: 20px;
    font-weight: bold;
    padding: 8px 16px;
    border: none;
    transition: background-color 0.3s ease;
    white-space: nowrap;
  }
  .btn-search:hover {
    background-color: #1e88e5;
  }
</style>


{% endblock %}

{% block content %}

<form method="get" class="search-bar">
  <div class="search-container">

  <input type="text" name="q" placeholder="ğŸ” æœå°‹å¯µç‰©æˆ–é£¼ä¸»..." value="{{ request.GET.q }}">
  <button type="submit" class="btn btn-search">ğŸ” æœå°‹</button></div>
</form>

{% if pets %}
<ul>
  {% for pet in pets %}
  <li>
    <div class="pet-card">
      <div class="pet-header" onclick="togglePetDetails(this)">
        {{ pet.name }}ï¼ˆé£¼ä¸»ï¼š{{ pet.owner.last_name }}{{ pet.owner.first_name|default:pet.owner.username }}ï¼‰
      </div>
      
<div class="pet-details" style="display: none;">
  <div class="add-buttons">
    <a href="{% url 'create_medical_record' pet.id %}" class="btn btn-medical">â• æ–°å¢ç—…æ­·</a>
    <a href="{% url 'add_vaccine' pet.id %}" class="btn btn-vaccine">ğŸ’‰ æ–°å¢ç–«è‹—</a>
    <a href="{% url 'add_deworm' pet.id %}" class="btn btn-deworm">ğŸª± æ–°å¢é©…èŸ²</a>
    <a href="{% url 'add_report' pet.id %}" class="btn btn-report">ğŸ“ æ–°å¢å ±å‘Š</a>
  </div>

        <h4>ç—…æ­·ç´€éŒ„</h4>
        {% for record in pet.medicalrecord_set.all|dictsortreversed:"visit_date" %}
          <div class="record-card medical-record" {% if forloop.counter > 1 %}style="display: none;"{% endif %}>
            <p><strong>ğŸ—“ï¸ æ—¥æœŸï¼š</strong>{{ record.visit_date }}</p>
            <p><strong>ğŸ“ åœ°é»ï¼š</strong>{{ record.clinic_location }}</p>
            <p><strong>ğŸ¦  è¨ºæ–·ï¼š</strong>{{ record.diagnosis|default:"æœªå¡«å¯«" }}</p>
            <p><strong>ğŸ’Š æ²»ç™‚ï¼š</strong>{{ record.treatment|default:"æœªå¡«å¯«" }}</p>
            <p><strong>ğŸ‘¨â€âš•ï¸ é†«å¸«ï¼š</strong>{{ record.vet.user.last_name }}{{ record.vet.user.first_name }}</p>
            <a href="{% url 'edit_medical_record' pet.id record.id %}">âœï¸ç·¨è¼¯</a>
            <a href="{% url 'delete_medical_record' record.id %}" onclick="return confirm('ç¢ºå®šåˆªé™¤é€™ç­†ç—…æ­·ç´€éŒ„å—ï¼Ÿ')">ğŸ—‘ï¸åˆªé™¤</a>
          </div>
        {% endfor %}
        {% if pet.medicalrecord_set.count > 1 %}
          <button onclick="toggleRecords('medical-record', this)" class="btn btn-secondary">é¡¯ç¤ºæ›´å¤šç—…æ­·ç´€éŒ„</button>
        {% endif %}

        <h4>ç–«è‹—ç´€éŒ„</h4>
        {% for record in pet.vaccine_records.all|dictsortreversed:"date" %}
          <div class="record-card vaccine-record" {% if forloop.counter > 1 %}style="display: none;"{% endif %}>
            <p><strong>ğŸ’‰ ç–«è‹—ï¼š</strong>{{ record.name }}</p>
            <p><strong>ğŸ“† æ—¥æœŸï¼š</strong>{{ record.date }}</p>
            <p><strong>ğŸ“ åœ°é»ï¼š</strong>{{ record.location }}</p>
            <p><strong>ğŸ‘¨â€âš•ï¸ é†«å¸«ï¼š</strong>{{ record.vet.user.last_name }}{{ record.vet.user.first_name }}</p>
            <a href="{% url 'edit_vaccine' pet.id record.id %}">âœï¸ç·¨è¼¯</a>
            <a href="{% url 'delete_vaccine' record.id %}" onclick="return confirm('ç¢ºå®šåˆªé™¤é€™ç­†ç–«è‹—ç´€éŒ„å—ï¼Ÿ')">ğŸ—‘ï¸åˆªé™¤</a>
          </div>
        {% endfor %}
        {% if pet.vaccine_records.count > 1 %}
          <button onclick="toggleRecords('vaccine-record', this)" class="btn btn-secondary">é¡¯ç¤ºæ›´å¤šç–«è‹—ç´€éŒ„</button>
        {% endif %}

        <h4>é©…èŸ²ç´€éŒ„</h4>
        {% for record in pet.deworm_records.all|dictsortreversed:"date" %}
          <div class="record-card deworm-record" {% if forloop.counter > 1 %}style="display: none;"{% endif %}>
            <p><strong>ğŸª± å“ç‰Œï¼š</strong>{{ record.name }}</p>
            <p><strong>ğŸ“† æ—¥æœŸï¼š</strong>{{ record.date }}</p>
            <p><strong>ğŸ“ åœ°é»ï¼š</strong>{{ record.location }}</p>
            <p><strong>ğŸ‘¨â€âš•ï¸ é†«å¸«ï¼š</strong>{{ record.vet.user.last_name }}{{ record.vet.user.first_name }}</p>
            <a href="{% url 'edit_deworm' pet.id record.id %}">âœï¸ç·¨è¼¯</a>
            <a href="{% url 'delete_deworm' record.id %}" onclick="return confirm('ç¢ºå®šåˆªé™¤é€™ç­†é©…èŸ²ç´€éŒ„å—ï¼Ÿ')">ğŸ—‘ï¸åˆªé™¤</a>
          </div>
        {% endfor %}
        {% if pet.deworm_records.count > 1 %}
          <button onclick="toggleRecords('deworm-record', this)" class="btn btn-secondary">é¡¯ç¤ºæ›´å¤šé©…èŸ²ç´€éŒ„</button>
        {% endif %}

        <h4>å ±å‘Š</h4>
        {% for report in pet.reports.all|dictsortreversed:"date_uploaded" %}
          <div class="record-card report-record" {% if forloop.counter > 1 %}style="display: none;"{% endif %}>
            <p><strong>ğŸ“„ æ¨™é¡Œï¼š</strong>{{ report.title }}</p>
            <p><strong>ğŸ“ æª”æ¡ˆï¼š</strong><a href="{{ report.pdf.url }}" target="_blank">{{ report.pdf.name }}</a></p>
            <a href="{% url 'delete_report' report.id %}" onclick="return confirm('ç¢ºå®šåˆªé™¤é€™ä»½å ±å‘Šå—ï¼Ÿ')">ğŸ—‘ï¸åˆªé™¤</a>
          </div>
        {% endfor %}
        {% if pet.reports.count > 1 %}
          <button onclick="toggleRecords('report-record', this)" class="btn btn-secondary">é¡¯ç¤ºæ›´å¤šå ±å‘Š</button>
        {% endif %}
      </div>
    </div>
  </li>
  {% endfor %}
</ul>
{% else %}
<p>ç›®å‰æ²’æœ‰çœ‹è¨ºå¯µç‰©ç´€éŒ„ã€‚</p>
{% endif %}
{% endblock %}

{% block extra_js %}
  {{ block.super }}
<script>
  function toggleRecords(className, button) {
    const elements = button.closest('.pet-details').querySelectorAll(`.${className}`);
    const isHidden = elements[1].style.display === 'none';
    elements.forEach((el, index) => {
      if (index > 0) el.style.display = isHidden ? 'block' : 'none';
    });
    button.textContent = isHidden ? 'éš±è—' + button.textContent.replace('é¡¯ç¤ºæ›´å¤š', '') : 'é¡¯ç¤ºæ›´å¤š' + button.textContent.replace('éš±è—', '');
  }

  function togglePetDetails(header) {
    const details = header.nextElementSibling;
    const isHidden = details.style.display === 'none' || details.style.display === '';
    details.style.display = isHidden ? 'block' : 'none';
  }
</script>
{% endblock %}

{% extends "vet_pages/base.html" %}

{% block title %}æˆ‘çš„çœ‹è¨ºå¯µç‰©{% endblock %}

{% block back_button %}
  <a href="{% url 'vet_home' %}" class="back-home">â† å›ä¸»æ§å°</a>
{% endblock %}

{% block header %}ğŸ¾ æˆ‘çš„çœ‹è¨ºå¯µç‰©{% endblock %}

{% block extra_css %}
<style>
  .record-card {
    background-color: #ffffff;
    border: 1px solid #e0e0e0;
    border-left: 5px solid #4db6ac;
    padding: 16px 20px;
    margin: 20px 0;
    border-radius: 10px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
    transition: box-shadow 0.3s ease;
  }

  .record-card:hover {
    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.08);
  }

  .record-card p {
    margin: 8px 0;
    line-height: 1.6;
    font-size: 16px;
  }

  h4 {
    margin-top: 24px;
    font-size: 18px;
    color: #444;
  }
</style>
{% endblock %}

{% block content %}
{% if pets %}
    <ul>
    {% for pet in pets %}
        <li>
          <div class="pet-card">
            <h3>{{ pet.name }}ï¼ˆé£¼ä¸»ï¼š{{ pet.owner.last_name }}{{ pet.owner.first_name|default:pet.owner.username }}ï¼‰</h3>
            - <a href="{% url 'create_medical_record' pet.id %}">æ–°å¢ç—…ä¾‹</a>
            - <a href="{% url 'add_vaccine' pet.id %}">æ–°å¢ç–«è‹—</a>
            - <a href="{% url 'add_deworm' pet.id %}">æ–°å¢é©…èŸ²</a>
            - <a href="{% url 'add_report' pet.id %}">æ–°å¢å ±å‘Š</a>
            
            <h4>ç—…ä¾‹ç´€éŒ„</h4>
            {% with latest_record=pet.medicalrecord_set.last %}
              {% if latest_record %}
                <div class="record-card">
                  <p><strong>ğŸ“… çœ‹è¨ºæ—¥æœŸï¼š</strong>{{ latest_record.visit_date }}</p>
                  <p><strong>ğŸ¥ çœ‹è¨ºåœ°é»ï¼š</strong>{{ latest_record.clinic_location }}</p>
                  <p><strong>ğŸ©º è¨ºæ–·çµæœï¼š</strong>{{ latest_record.diagnosis|default:"æœªå¡«å¯«" }}</p>
                  <p><strong>ğŸ’Š æ²»ç™‚å…§å®¹ï¼š</strong>{{ latest_record.treatment|default:"æœªå¡«å¯«" }}</p>
                  <p><strong>ğŸ‘¨â€âš•ï¸ çœ‹è¨ºç¸é†«ï¼š</strong>{{ latest_record.vet.user.last_name }}{{ latest_record.vet.user.first_name }}</p>
                </div>

                <button class="toggle-more-btn" onclick="toggleMore(this)">é¡¯ç¤ºæ›´å¤šç—…ä¾‹ç´€éŒ„</button>

                <div class="record-more" style="display:none;">
                  {% for record in pet.medicalrecord_set.all|dictsortreversed:"visit_date" %}
                    {% if record != latest_record %}
                      <div class="record-card">
                        <p><strong>ğŸ“… çœ‹è¨ºæ—¥æœŸï¼š</strong>{{ record.visit_date }}</p>
                        <p><strong>ğŸ¥ çœ‹è¨ºåœ°é»ï¼š</strong>{{ record.clinic_location }}</p>
                        <p><strong>ğŸ©º è¨ºæ–·çµæœï¼š</strong>{{ record.diagnosis|default:"æœªå¡«å¯«" }}</p>
                        <p><strong>ğŸ’Š æ²»ç™‚å…§å®¹ï¼š</strong>{{ record.treatment|default:"æœªå¡«å¯«" }}</p>
                        <p><strong>ğŸ‘¨â€âš•ï¸ çœ‹è¨ºç¸é†«ï¼š</strong>{{ record.vet.user.last_name }}{{ record.vet.user.first_name }}</p>
                      </div>
                    {% endif %}
                  {% endfor %}
                </div>
              {% else %}
                <p>ç„¡ç—…ä¾‹ç´€éŒ„</p>
              {% endif %}
            {% endwith %}


            <h4>ç–«è‹—ç´€éŒ„</h4>
            <ul>
              {% for record in pet.vaccine_records.all|dictsortreversed:"date" %}
                <li>
                  ç–«è‹—å“ç‰Œï¼š{{ record.name }}<br>
                  æ–½æ‰“æ™‚é–“ï¼š{{ record.date }}<br>
                  æ–½æ‰“åœ°é»ï¼š{{ record.location }}<br>
                  æ–½æ‰“ç¸é†«ï¼š{{ record.vet.user.last_name }}{{ record.vet.user.first_name }}<br>

                  <a href="{% url 'edit_vaccine' pet.id record.id %}">âœï¸ç·¨è¼¯</a>
                  <a href="{% url 'delete_vaccine' record.id %}" onclick="return confirm('ç¢ºå®šåˆªé™¤é€™ç­†ç–«è‹—ç´€éŒ„å—ï¼Ÿ')">ğŸ—‘ï¸åˆªé™¤</a>
                </li>
              {% empty %}
                <li>ç„¡ç–«è‹—ç´€éŒ„</li>
              {% endfor %}
            </ul>

            <h4>é©…èŸ²ç´€éŒ„</h4>
            <ul>
              {% for record in pet.deworm_records.all|dictsortreversed:"date" %}
                <li>
                  é©…èŸ²å“ç‰Œï¼š{{ record.name }}<br>
                  æ–½æ‰“æ™‚é–“ï¼š{{ record.date }}<br>
                  æ–½æ‰“åœ°é»ï¼š{{ record.location }}<br>
                  æ–½æ‰“ç¸é†«ï¼š{{ record.vet.user.last_name }}{{ record.vet.user.first_name }}<br>

                  <a href="{% url 'edit_deworm' pet.id record.id %}">âœï¸ç·¨è¼¯</a>
                  <a href="{% url 'delete_deworm' record.id %}" onclick="return confirm('ç¢ºå®šåˆªé™¤é€™ç­†é©…èŸ²ç´€éŒ„å—ï¼Ÿ')">ğŸ—‘ï¸åˆªé™¤</a>
                </li>
              {% empty %}
                <li>ç„¡é©…èŸ²ç´€éŒ„</li>
              {% endfor %}
            </ul>

            <h4>å ±å‘Š</h4>
            <ul>
              {% for report in pet.reports.all|dictsortreversed:"date_uploaded" %}
              <li>
                <strong>æ¨™é¡Œï¼š</strong>{{ report.title }}<br>
                <strong>æª”æ¡ˆï¼š</strong><a href="{{ report.pdf.url }}" target="_blank">{{ report.pdf }}</a><br>

                <a href="{% url 'delete_report' report.id %}" onclick="return confirm('ç¢ºå®šåˆªé™¤é€™ä»½å ±å‘Šå—ï¼Ÿ')">ğŸ—‘ï¸åˆªé™¤</a>
              </li>
              {% empty %}
                <li>ç„¡å ±å‘Š</li>
              {% endfor %}
            </ul>
        </div>
    </li>
    {% endfor %}
    </ul>
{% else %}
    <p>ç›®å‰æ²’æœ‰çœ‹è¨ºå¯µç‰©ç´€éŒ„ã€‚</p>
{% endif %}

{% endblock %}

{% block extra_js %}
<script>
  function toggleMore(btn) {
    const moreDiv = btn.nextElementSibling;
    if (moreDiv.style.display === "none") {
      moreDiv.style.display = "block";
      btn.textContent = "éš±è—å…¶ä»–ç´€éŒ„";
    } else {
      moreDiv.style.display = "none";
      btn.textContent = "é¡¯ç¤ºæ›´å¤šç—…ä¾‹ç´€éŒ„";
    }
  }
</script>
{% endblock %}
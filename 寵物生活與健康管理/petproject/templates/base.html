{% load static %}
<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>{% block title %}毛孩幸福生活{% endblock %}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="{% block meta_description %}毛日好 Paw&Day - 為毛小孩與飼主打造的健康管理平台{% endblock %}">
  
  <!-- Favicon -->
  <link rel="icon" type="image/x-icon" href="{% static 'images/favicon.ico' %}">
  
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  
  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
  
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
  
  <!-- 自訂樣式 -->
  <link rel="stylesheet" href="{% static 'css/theme.css' %}">
  <link rel="stylesheet" href="{% static 'css/base.css' %}">
  
  {% block extra_css %}
  <!-- 子模板可以插入額外的 CSS -->
  {% endblock %}
  
  <!-- Meta 資訊 -->
  <meta name="author" content="毛日好 Paw&Day">
  <meta name="keywords" content="寵物,健康管理,獸醫,預約,寵物醫院">
  
  <!-- Open Graph 資訊 -->
  <meta property="og:title" content="{% block og_title %}{{ block.super }}毛孩幸福生活{% endblock %}">
  <meta property="og:description" content="{% block og_description %}毛日好 Paw&Day - 為毛小孩與飼主打造的健康管理平台{% endblock %}">
  <meta property="og:type" content="website">
  <meta property="og:url" content="{{ request.build_absolute_uri }}">
  <meta property="og:image" content="{% static 'images/og-image.jpg' %}">
  
  <!-- 調試模式標記 -->
  {% if debug %}
  <script>window.DEBUG = true;</script>
  {% endif %}
</head>
<body>

  <!-- 用戶資訊 (隱藏，供 JavaScript 使用) -->
  <div class="d-none" 
       data-user-authenticated="{% if user.is_authenticated %}true{% else %}false{% endif %}"
       {% if user.profile %}data-user-type="{{ user.profile.account_type }}"{% endif %}>
  </div>

  <!-- Skip to content link for accessibility -->
  <a href="#main-content" class="skip-link">跳至主要內容</a>

  <!-- Loading Spinner -->
  <div class="loading-spinner" id="loadingSpinner">
    <div class="spinner-border text-warning" role="status" style="width: 3rem; height: 3rem;">
      <span class="visually-hidden">載入中...</span>
    </div>
  </div>

  <!-- Messages Container -->
  {% if messages %}
  <div class="messages-container">
    {% for message in messages %}
      <div class="alert alert-{{ message.tags|default:'info' }} alert-dismissible fade show" role="alert">
        {% if message.tags == 'error' %}
          <i class="bi bi-exclamation-triangle-fill me-2" aria-hidden="true"></i>
        {% elif message.tags == 'success' %}
          <i class="bi bi-check-circle-fill me-2" aria-hidden="true"></i>
        {% elif message.tags == 'warning' %}
          <i class="bi bi-exclamation-circle-fill me-2" aria-hidden="true"></i>
        {% else %}
          <i class="bi bi-info-circle-fill me-2" aria-hidden="true"></i>
        {% endif %}
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="關閉"></button>
      </div>
    {% endfor %}
  </div>
  {% endif %}

  <!-- Header 區塊 -->
  <header class="custom-header">
    <div class="container">
      <nav class="navbar navbar-expand-lg" role="navigation" aria-label="主要導航">
        <div class="container-fluid">
          <!-- Logo -->
          <a href="{% url 'home' %}" class="logo navbar-brand" aria-label="回到首頁">
            <img src="{% static 'images/logo_cat_dog.jpg' %}" alt="毛日好 Logo" class="img-fluid">
            <span>PAW<br>DAY</span>
          </a>

          <!-- 手機版選單切換按鈕 -->
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" 
                  aria-controls="navbarNav" aria-expanded="false" aria-label="切換導航選單">
            <span class="navbar-toggler-icon"></span>
          </button>

          <!-- 導航選單 -->
          <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ms-auto">
              {% if user.is_authenticated %}
                <!-- 飼主專用選單 -->
                {% if user.profile.account_type == 'owner' %}
                  <li class="nav-item">
                    <a class="nav-link" href="{% url 'pet_list' %}" aria-label="管理我的寵物">
                      <i class="bi bi-heart-fill me-1" aria-hidden="true"></i>我的寵物
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="{% url 'health_rec' %}" aria-label="查看健康紀錄">
                      <i class="bi bi-heart-pulse me-1" aria-hidden="true"></i>健康紀錄
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="{% url 'my_appointments' %}" aria-label="我的預約">
                      <i class="bi bi-calendar-check me-1" aria-hidden="true"></i>我的預約
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="{% url 'map' %}" aria-label="搜尋附近醫院">
                      <i class="bi bi-geo-alt me-1" aria-hidden="true"></i>搜尋附近
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="{% url 'emergency_map' %}" aria-label="急診醫院地圖">
                      <i class="bi bi-exclamation-triangle me-1" aria-hidden="true"></i>急診地圖
                    </a>
                  </li>
                
                <!-- 診所管理員專用選單 -->
                {% elif user.profile.account_type == 'clinic_admin' %}
                  <li class="nav-item">
                    <a class="nav-link" href="{% url 'clinic_dashboard' %}" aria-label="診所管理">
                      <i class="bi bi-hospital me-1" aria-hidden="true"></i>診所管理
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="{% url 'clinic_appointments' %}" aria-label="預約管理">
                      <i class="bi bi-calendar-check me-1" aria-hidden="true"></i>預約管理
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="{% url 'manage_doctors' %}" aria-label="醫師管理">
                      <i class="bi bi-people me-1" aria-hidden="true"></i>醫師管理
                    </a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" href="{% url 'manage_schedules' %}" aria-label="排班管理">
                      <i class="bi bi-calendar-week me-1" aria-hidden="true"></i>排班管理
                    </a>
                  </li>
                {% endif %}

                <!-- 系統管理員選單 -->
                {% if user.is_staff %}
                  <li class="nav-item">
                    <a class="nav-link" href="{% url 'admin:index' %}" aria-label="系統後台">
                      <i class="bi bi-gear me-1" aria-hidden="true"></i>後台管理
                    </a>
                  </li>
                {% else %}
                  <li class="nav-item">
                    <a class="nav-link" href="{% url 'edit_profile' %}" aria-label="修改個人資料">
                      <i class="bi bi-person-gear me-1" aria-hidden="true"></i>修改帳號資料
                    </a>
                  </li>
                {% endif %}
                
                <!-- 通知 -->
                <li class="nav-item">
                  <a class="nav-link" href="{% url 'notification_page' %}" id="notification-link" aria-label="查看通知">
                    <i class="bi bi-bell me-1" aria-hidden="true"></i>通知
                    <span id="notification-count" class="notification-badge d-none" aria-label="未讀通知數量"></span>
                  </a>
                </li>
                
                <!-- 登出 -->
                <li class="nav-item">
                  <a class="nav-link" href="{% url 'account_logout' %}" aria-label="登出系統">
                    <i class="bi bi-box-arrow-right me-1" aria-hidden="true"></i>登出
                  </a>
                </li>
              {% else %}
                <!-- 未登入用戶選單 -->
                <li class="nav-item">
                  <a class="nav-link" href="{% url 'map' %}" aria-label="搜尋寵物醫院">
                    <i class="bi bi-geo-alt me-1" aria-hidden="true"></i>尋找醫院
                  </a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="{% url 'emergency_map' %}" aria-label="急診醫院地圖">
                    <i class="bi bi-exclamation-triangle me-1" aria-hidden="true"></i>急診地圖
                  </a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="{% url 'account_login' %}" aria-label="登入系統">
                    <i class="bi bi-box-arrow-in-right me-1" aria-hidden="true"></i>登入
                  </a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="{% url 'account_signup' %}" aria-label="註冊帳號">
                    <i class="bi bi-person-plus me-1" aria-hidden="true"></i>註冊
                  </a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="{% url 'clinic_registration' %}" aria-label="診所註冊">
                    <i class="bi bi-hospital me-1" aria-hidden="true"></i>診所註冊
                  </a>
                </li>
              {% endif %}
            </ul>
          </div>
        </div>
      </nav>
    </div>
  </header>

  <!-- 主內容區塊 -->
  <main class="fade-in" id="main-content">
    {% block header %}{% endblock %}
    
    {% block content %}
    <!-- 子模板主內容會顯示在這裡 -->
    {% endblock %}
  </main>

  <!-- Footer 區塊 -->
  <footer class="custom-footer">
    <div class="container">
      <div class="row">
        <div class="col-lg-4 col-md-6 mb-4">
          <h4 class="footer-title">
            <i class="bi bi-info-circle me-2" aria-hidden="true"></i>網站簡介
          </h4>
          <p class="footer-text">這是一個為毛小孩與飼主打造的平台，讓你輕鬆記錄、分享毛孩生活與健康資訊。</p>
          
          <!-- 快速連結 -->
          <div class="mt-3">
            <a href="{% url 'map' %}" class="btn btn-outline-secondary btn-sm me-2">
              <i class="bi bi-geo-alt me-1"></i>尋找醫院
            </a>
            <a href="{% url 'emergency_map' %}" class="btn btn-outline-danger btn-sm">
              <i class="bi bi-exclamation-triangle me-1"></i>急診
            </a>
          </div>
        </div>
        
        <div class="col-lg-4 col-md-6 mb-4">
          <h4 class="footer-title">
            <i class="bi bi-telephone me-2" aria-hidden="true"></i>客服聯絡資訊
          </h4>
          <p class="footer-text">
            Email：<a href="mailto:pawday114404@gmail.com">pawday114404@gmail.com</a><br>
            電話：<a href="tel:+886255667788">02-5566-7788</a><br>
            服務時間：週一至五 10:00 - 18:00
          </p>
        </div>
        
        <div class="col-lg-4 col-md-12 mb-4">
          <h4 class="footer-title">
            <i class="bi bi-share me-2" aria-hidden="true"></i>社群連結
          </h4>
          <p class="footer-text">
            IG：@pawday114404<br>
            FB：毛日好 Paw&Day<br>
            LINE：@pawday114404
          </p>
          
          <!-- 統計資訊 -->
          <div class="mt-3">
            <small class="text-muted">
              <i class="bi bi-heart me-1"></i>
              為超過 <strong>10,000+</strong> 隻毛孩提供服務
            </small>
          </div>
        </div>
      </div>
      
      <hr class="my-4">
      
      <div class="row">
        <div class="col-md-6">
          <p class="footer-text mb-0">&copy; 2025 毛日好 Paw&Day. All rights reserved.</p>
        </div>
        <div class="col-md-6 text-md-end">
          <small class="text-muted">
            <a href="#" class="text-decoration-none me-3">隱私政策</a>
            <a href="#" class="text-decoration-none me-3">服務條款</a>
            <a href="#" class="text-decoration-none">意見回饋</a>
          </small>
        </div>
      </div>
    </div>
  </footer>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  
  <!-- 自訂 JavaScript -->
  <script src="{% static 'js/utils.js' %}"></script>
  <script src="{% static 'js/base.js' %}"></script>
  
  {% block extra_js %}
  <!-- 子模板可以插入額外的 JS -->
  {% endblock %}
  
  <!-- CSRF Token for AJAX -->
  <script>
    // 為 AJAX 請求提供 CSRF Token
    document.addEventListener('DOMContentLoaded', function() {
      const csrfToken = '{{ csrf_token }}';
      
      // 設定全局 AJAX 預設值
      if (window.fetch) {
        const originalFetch = window.fetch;
        window.fetch = function(url, options = {}) {
          if (options.method && options.method.toUpperCase() !== 'GET') {
            options.headers = {
              'X-CSRFToken': csrfToken,
              ...options.headers
            };
          }
          return originalFetch(url, options);
        };
      }
    });
  </script>
  
  <!-- Google Analytics (如果需要) -->
  {% if not debug %}
  <!-- 在生產環境中插入 Google Analytics 代碼 -->
  {% endif %}
</body>
</html>

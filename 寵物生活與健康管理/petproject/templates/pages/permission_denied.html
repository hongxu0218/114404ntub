{% extends 'base.html' %}

{% block title %}權限被拒絕 - 毛日好{% endblock %}

{% block content %}
<div class="container">
  <div class="row justify-content-center align-items-center min-vh-100">
    <div class="col-lg-8 col-md-10 text-center">
      <div class="error-card p-5">
        <!-- 錯誤圖示 -->
        <div class="error-icon mb-4">
          <i class="bi bi-lock" style="font-size: 5rem; color: var(--warning-color);"></i>
        </div>
        
        <!-- 錯誤標題 -->
        <h2 class="error-title mb-3" style="color: var(--text-dark);">
          <i class="bi bi-shield-x me-2"></i>
          存取被拒絕
        </h2>
        
        <!-- 錯誤描述 -->
        <div class="error-description mb-4">
          <p class="lead text-muted">很抱歉，您的帳號無法執行此操作 🚫</p>
          
          {% if user.is_authenticated %}
            <div class="user-info mb-4 p-3 bg-light rounded">
              <h6 class="mb-2">目前登入身份：</h6>
              <div class="d-flex justify-content-center align-items-center flex-wrap">
                <span class="badge bg-primary me-2 mb-2">
                  <i class="bi bi-person-circle me-1"></i>
                  {{ user.get_full_name|default:user.username }}
                </span>
                {% if user.profile %}
                  <span class="badge bg-secondary me-2 mb-2">
                    <i class="bi bi-tag me-1"></i>
                    {% if user.profile.account_type == 'owner' %}
                      飼主帳號
                    {% elif user.profile.account_type == 'clinic_admin' %}
                      診所管理員
                    {% elif user.profile.account_type == 'vet' %}
                      獸醫師
                    {% else %}
                      {{ user.profile.get_account_type_display }}
                    {% endif %}
                  </span>
                {% endif %}
                {% if user.is_staff %}
                  <span class="badge bg-warning mb-2">
                    <i class="bi bi-gear me-1"></i>
                    系統管理員
                  </span>
                {% endif %}
              </div>
            </div>
          {% endif %}
          
          <div class="possible-reasons">
            <h6 class="text-muted mb-3">可能的原因：</h6>
            <div class="row g-3">
              <div class="col-md-6">
                <div class="reason-card p-3 border rounded">
                  <i class="bi bi-person-x text-warning mb-2" style="font-size: 2rem;"></i>
                  <h6>帳號類型限制</h6>
                  <p class="small text-muted mb-0">
                    此功能僅限特定類型的使用者使用
                  </p>
                </div>
              </div>
              <div class="col-md-6">
                <div class="reason-card p-3 border rounded">
                  <i class="bi bi-shield-check text-info mb-2" style="font-size: 2rem;"></i>
                  <h6>驗證狀態</h6>
                  <p class="small text-muted mb-0">
                    需要完成帳號驗證或審核流程
                  </p>
                </div>
              </div>
              <div class="col-md-6">
                <div class="reason-card p-3 border rounded">
                  <i class="bi bi-building text-success mb-2" style="font-size: 2rem;"></i>
                  <h6>機構權限</h6>
                  <p class="small text-muted mb-0">
                    可能需要特定診所或機構的授權
                  </p>
                </div>
              </div>
              <div class="col-md-6">
                <div class="reason-card p-3 border rounded">
                  <i class="bi bi-clock text-danger mb-2" style="font-size: 2rem;"></i>
                  <h6>時間限制</h6>
                  <p class="small text-muted mb-0">
                    某些功能可能有使用時間限制
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- 建議操作 -->
        <div class="suggested-actions mb-4">
          <h6 class="text-muted mb-3">建議您：</h6>
          
          {% if not user.is_authenticated %}
            <div class="alert alert-info">
              <i class="bi bi-info-circle me-2"></i>
              您尚未登入，請先登入後再試
            </div>
          {% endif %}
          
          <div class="row g-2">
            <div class="col-md-3">
              <a href="{% url 'home' %}" class="btn btn-primary-custom w-100">
                <i class="bi bi-house-door me-1"></i>
                返回首頁
              </a>
            </div>
            
            {% if user.is_authenticated %}
              <div class="col-md-3">
                <a href="{% url 'edit_profile' %}" class="btn btn-outline-primary w-100">
                  <i class="bi bi-person-gear me-1"></i>
                  檢查帳號
                </a>
              </div>
              
              {% if user.profile.account_type == 'vet' and not user.profile.is_verified_vet %}
                <div class="col-md-3">
                  <a href="{% url 'verify_vet_license' %}" class="btn btn-warning w-100">
                    <i class="bi bi-patch-check me-1"></i>
                    驗證執照
                  </a>
                </div>
              {% endif %}
              
              <div class="col-md-3">
                <a href="{% url 'account_logout' %}" class="btn btn-outline-secondary w-100">
                  <i class="bi bi-box-arrow-right me-1"></i>
                  切換帳號
                </a>
              </div>
            {% else %}
              <div class="col-md-3">
                <a href="{% url 'account_login' %}" class="btn btn-success w-100">
                  <i class="bi bi-box-arrow-in-right me-1"></i>
                  立即登入
                </a>
              </div>
              <div class="col-md-3">
                <a href="{% url 'account_signup' %}" class="btn btn-outline-success w-100">
                  <i class="bi bi-person-plus me-1"></i>
                  註冊帳號
                </a>
              </div>
              <div class="col-md-3">
                <a href="{% url 'clinic_registration' %}" class="btn btn-info w-100">
                  <i class="bi bi-hospital me-1"></i>
                  診所註冊
                </a>
              </div>
            {% endif %}
          </div>
        </div>
        
        <!-- 聯絡客服 -->
        <div class="contact-support mb-4">
          <div class="alert alert-light border-primary">
            <h6 class="alert-heading">
              <i class="bi bi-headset text-primary me-2"></i>
              需要協助？
            </h6>
            <p class="mb-2">如果您認為這是錯誤，或需要申請特殊權限，請聯絡我們的客服團隊：</p>
            <div class="row g-2">
              <div class="col-md-6">
                <a href="mailto:pawday114404@gmail.com" class="btn btn-outline-primary btn-sm w-100">
                  <i class="bi bi-envelope me-1"></i>
                  發送Email
                </a>
              </div>
              <div class="col-md-6">
                <a href="tel:+886255667788" class="btn btn-outline-primary btn-sm w-100">
                  <i class="bi bi-telephone me-1"></i>
                  撥打電話
                </a>
              </div>
            </div>
          </div>
        </div>
        
        <!-- 可愛的守門員插圖區域 -->
        <div class="mt-5 text-muted">
          <div style="font-size: 2rem; margin-bottom: 1rem;">🐕‍🦺🚪</div>
          <small>我們的守門犬正在保護這個功能的安全！</small>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
.error-card {
  background: linear-gradient(135deg, #ffffff 0%, var(--warm-card) 100%);
  border-radius: 20px;
  box-shadow: 0 8px 32px var(--shadow-light);
  border: 1px solid var(--border-light);
}

.error-icon {
  animation: swing 2s infinite;
}

@keyframes swing {
  0%, 100% { transform: rotate(0deg); }
  25% { transform: rotate(10deg); }
  75% { transform: rotate(-10deg); }
}

.reason-card {
  transition: all 0.3s ease;
  text-align: center;
  height: 100%;
}

.reason-card:hover {
  background-color: var(--warm-bg);
  transform: translateY(-2px);
  box-shadow: 0 4px 12px var(--shadow-light);
}

.user-info {
  border-left: 4px solid var(--primary-orange);
}

.suggested-actions .btn {
  font-size: 0.9rem;
}

.min-vh-100 {
  min-height: calc(100vh - 200px);
}

@media (max-width: 768px) {
  .reason-card {
    margin-bottom: 1rem;
  }
  
  .suggested-actions .col-md-3 {
    margin-bottom: 0.5rem;
  }
}
</style>
{% endblock %}
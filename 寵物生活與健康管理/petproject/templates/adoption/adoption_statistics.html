<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>統計資訊 - 認領養平台</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .header { background: #007bff; color: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: #f8f9fa; border: 1px solid #ddd; border-radius: 8px; padding: 20px; text-align: center; }
        .chart-section { background: white; border: 1px solid #ddd; border-radius: 8px; padding: 20px; margin-bottom: 20px; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 10px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background: #f8f9fa; }
        .progress-bar { background: #e9ecef; height: 20px; border-radius: 10px; overflow: hidden; }
        .progress-fill { background: #007bff; height: 100%; transition: width 0.3s ease; }
        .btn { padding: 8px 16px; text-decoration: none; border-radius: 4px; display: inline-block; margin: 2px; }
        .btn-primary { background: #007bff; color: white; }
        .btn-success { background: #28a745; color: white; }
        .shelter-name { 
            max-width: 200px; 
            overflow: hidden; 
            text-overflow: ellipsis; 
            white-space: nowrap; 
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>📊 認領養統計資訊</h1>
        <a href="/adoption/" class="btn btn-primary">回首頁</a>
        <a href="/adoption/list/" class="btn btn-success">瀏覽動物</a>
    </div>

    <!-- 總體統計 -->
    <div class="stats-grid">
        <div class="stat-card">
            <h2 style="color: #007bff; margin: 0;">{{ total_animals }}</h2>
            <h4>總登記動物數</h4>
            <p>目前系統中所有的動物資料</p>
        </div>
        <div class="stat-card">
            <h2 style="color: #28a745; margin: 0;">{{ available_animals }}</h2>
            <h4>等待認養動物</h4>
            <p>目前開放認養的動物數量</p>
        </div>
    </div>

    <div class="stats-grid">
        <!-- 按種類統計 -->
        <div class="chart-section">
            <h3>🐾 動物種類分布</h3>
            {% if kind_stats %}
            <table>
                <thead>
                    <tr>
                        <th>動物種類</th>
                        <th>數量</th>
                        <th>比例</th>
                    </tr>
                </thead>
                <tbody>
                    {% for stat in kind_stats %}
                    {% if stat.animal_kind %}
                    <tr>
                        <td>
                            <a href="/adoption/list/?kind={{ stat.animal_kind }}" style="text-decoration: none; color: #007bff;">
                                {{ stat.animal_kind }}
                            </a>
                        </td>
                        <td>{{ stat.count }}</td>
                        <td>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: {% widthratio stat.count total_animals 100 %}%"></div>
                            </div>
                            {% widthratio stat.count total_animals 100 %}%
                        </td>
                    </tr>
                    {% endif %}
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <p>暫無統計資料</p>
            {% endif %}
        </div>

        <!-- 按收容所統計 -->
        <div class="chart-section">
            <h3>🏥 收容所分布 (前10名)</h3>
            {% if shelter_stats %}
            <table>
                <thead>
                    <tr>
                        <th style="width: 50%;">收容所名稱</th>
                        <th style="width: 20%;">動物數量</th>
                        <th style="width: 30%;">比例</th>
                    </tr>
                </thead>
                <tbody>
                    {% for stat in shelter_stats %}
                    {% if stat.shelter_name %}
                    <tr>
                        <td class="shelter-name" title="{{ stat.shelter_name }}">
                            {{ stat.shelter_name }}
                        </td>
                        <td>{{ stat.count }}</td>
                        <td>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: {% widthratio stat.count total_animals 100 %}%; background: #17a2b8;"></div>
                            </div>
                            {% widthratio stat.count total_animals 100 %}%
                        </td>
                    </tr>
                    {% endif %}
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <p>暫無統計資料</p>
            {% endif %}
        </div>
    </div>

    <!-- 快速連結 -->
    <div class="chart-section" style="text-align: center;">
        <h3>想要認養動物嗎？</h3>
        <p>瀏覽所有等待認養的可愛動物</p>
        <a href="/adoption/list/" class="btn btn-success" style="font-size: 16px; padding: 12px 24px;">
            💝 查看所有動物
        </a>
    </div>
</body>
</html>
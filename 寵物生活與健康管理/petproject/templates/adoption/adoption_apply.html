<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>申請認養 {{ animal.animal_title|default:"動物" }} - 認領養平台</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            background-color: #f8f9fa; 
        }
        .container { 
            max-width: 800px; 
            margin: 0 auto; 
            background: white; 
            border-radius: 8px; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.1); 
        }
        .header { 
            background: #007bff; 
            color: white; 
            padding: 20px; 
            border-radius: 8px 8px 0 0; 
        }
        .content { 
            padding: 30px; 
        }
        .btn { 
            padding: 8px 16px; 
            text-decoration: none; 
            border-radius: 4px; 
            display: inline-block; 
            margin: 2px; 
            border: none;
            cursor: pointer;
        }
        .btn-primary { background: #007bff; color: white; }
        .btn-success { background: #28a745; color: white; font-size: 16px; padding: 12px 24px; }
        .btn-outline { background: white; color: #007bff; border: 1px solid #007bff; }
        
        .animal-preview { 
            background: #f8f9fa; 
            border: 1px solid #dee2e6; 
            border-radius: 8px; 
            padding: 20px; 
            margin-bottom: 30px; 
            display: flex;
            align-items: center;
            gap: 20px;
        }
        .animal-preview img { 
            width: 120px; 
            height: 120px; 
            object-fit: cover; 
            border-radius: 8px; 
        }
        .animal-info h3 { margin: 0 0 10px 0; color: #007bff; }
        .animal-info p { margin: 5px 0; color: #666; }
        
        .form-section { 
            background: white; 
            border: 1px solid #dee2e6; 
            border-radius: 8px; 
            padding: 25px; 
            margin-bottom: 20px; 
        }
        .form-section h3 { 
            margin: 0 0 20px 0; 
            color: #495057; 
            border-bottom: 2px solid #007bff; 
            padding-bottom: 10px; 
        }
        
        .form-group { 
            margin-bottom: 20px; 
        }
        .form-group label { 
            display: block; 
            margin-bottom: 5px; 
            font-weight: bold; 
            color: #495057; 
        }
        .required { color: #dc3545; }
        
        .form-control { 
            width: 100%; 
            padding: 12px; 
            border: 1px solid #ced4da; 
            border-radius: 4px; 
            font-size: 16px;
            box-sizing: border-box;
        }
        .form-control:focus { 
            border-color: #007bff; 
            outline: none; 
            box-shadow: 0 0 0 2px rgba(0,123,255,0.25); 
        }
        
        .form-row { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 15px; 
        }
        
        textarea.form-control { 
            resize: vertical; 
            min-height: 100px; 
        }
        
        .checkbox-group { 
            display: flex; 
            align-items: center; 
            gap: 10px; 
            padding: 15px; 
            background: #e3f2fd; 
            border-radius: 4px; 
        }
        .checkbox-group input[type="checkbox"] { 
            width: 18px; 
            height: 18px; 
        }
        
        .notice { 
            background: #d1ecf1; 
            border: 1px solid #bee5eb; 
            border-radius: 4px; 
            padding: 20px; 
            margin: 20px 0; 
        }
        .notice h4 { 
            margin: 0 0 10px 0; 
            color: #0c5460; 
        }
        .notice ul { 
            margin: 0; 
            padding-left: 20px; 
            color: #0c5460; 
        }
        
        .form-actions { 
            text-align: right; 
            padding-top: 20px; 
            border-top: 1px solid #dee2e6; 
        }
        
        @media (max-width: 768px) {
            .form-row { grid-template-columns: 1fr; }
            .animal-preview { flex-direction: column; text-align: center; }
            .content { padding: 20px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>📝 認養申請表</h1>
            <a href="/adoption/detail/{{ animal.animal_id }}/" class="btn btn-outline">返回動物詳情</a>
            <a href="/adoption/list/" class="btn btn-outline">返回列表</a>
        </div>

        <div class="content">
            <!-- 動物資訊概覽 -->
            <div class="animal-preview">
                <img src="{{ animal.album_file|default:'/static/images/no-pet-image.jpg' }}" 
                     alt="{{ animal.animal_title }}"
                     onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIwIiBoZWlnaHQ9IjEyMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZjhmOWZhIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxMiIgZmlsbD0iIzZjNzU3ZCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPuayoeWcluePuzwvdGV4dD48L3N2Zz4='">
                <div class="animal-info">
                    <h3>{{ animal.animal_title|default:"可愛的小寶貝" }}</h3>
                    <p><strong>種類：</strong>{{ animal.animal_kind }} | <strong>性別：</strong>{{ animal.animal_sex }} | <strong>年齡：</strong>{{ animal.animal_age }}</p>
                    <p><strong>收容所：</strong>{{ animal.shelter_name }}</p>
                    <p><strong>動物編號：</strong>{{ animal.animal_id }}</p>
                </div>
            </div>

            <!-- 申請表單 -->
            <form method="post">
                {% csrf_token %}
                
                <!-- 申請人基本資料 -->
                <div class="form-section">
                    <h3>👤 申請人基本資料</h3>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="applicant_name">申請人姓名 <span class="required">*</span></label>
                            <input type="text" 
                                   class="form-control" 
                                   id="applicant_name" 
                                   name="applicant_name" 
                                   value="{{ user.last_name }}{{ user.first_name }}" 
                                   required>
                        </div>
                        <div class="form-group">
                            <label for="applicant_phone">聯絡電話 <span class="required">*</span></label>
                            <input type="tel" 
                                   class="form-control" 
                                   id="applicant_phone" 
                                   name="applicant_phone" 
                                   value="{{ user.profile.phone_number|default:'' }}" 
                                   placeholder="請輸入您的手機號碼"
                                   required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="applicant_email">電子信箱 <span class="required">*</span></label>
                        <input type="email" 
                               class="form-control" 
                               id="applicant_email" 
                               name="applicant_email" 
                               value="{{ user.email }}" 
                               required>
                    </div>

                    <div class="form-group">
                        <label for="applicant_address">居住地址 <span class="required">*</span></label>
                        <textarea class="form-control" 
                                  id="applicant_address" 
                                  name="applicant_address" 
                                  rows="3" 
                                  placeholder="請詳細填寫您的居住地址（包含縣市、區域、街道等）" 
                                  required></textarea>
                    </div>
                </div>

                <!-- 居住環境與飼養條件 -->
                <div class="form-section">
                    <h3>🏠 居住環境與飼養條件</h3>
                    
                    <div class="form-group">
                        <label for="housing_type">居住環境 <span class="required">*</span></label>
                        <select class="form-control" id="housing_type" name="housing_type" required>
                            <option value="">請選擇您的居住環境</option>
                            <option value="透天厝">透天厝</option>
                            <option value="公寓">公寓</option>
                            <option value="大廈">大廈</option>
                            <option value="套房">套房</option>
                            <option value="其他">其他</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="experience">飼養經驗 <span class="required">*</span></label>
                        <textarea class="form-control" 
                                  id="experience" 
                                  name="experience" 
                                  rows="4" 
                                  placeholder="請詳細描述您的寵物飼養經驗，包括：&#10;• 曾經飼養過什麼動物？&#10;• 飼養了多久？&#10;• 如何照顧寵物的健康？&#10;• 遇到過什麼問題及如何解決？&#10;• 如果沒有經驗，請說明您的學習計劃" 
                                  required></textarea>
                    </div>
                </div>

                <!-- 認養承諾 -->
                <div class="form-section">
                    <h3>💝 認養承諾</h3>
                    
                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" 
                                   id="family_consent" 
                                   name="family_consent" 
                                   required>
                            <label for="family_consent">
                                我確認家人都同意認養此動物，並願意共同承擔照顧責任 <span class="required">*</span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- 申請須知 -->
                <div class="notice">
                    <h4>📋 申請須知與承諾</h4>
                    <ul>
                        <li><strong>審核流程：</strong>收容所會審核您的申請資料，審核通過後會與您聯絡安排面談</li>
                        <li><strong>飼養責任：</strong>請確保您有足夠的時間、經濟能力和愛心照顧動物</li>
                        <li><strong>醫療照顧：</strong>認養後請定期為動物進行健康檢查和施打疫苗</li>
                        <li><strong>終生承諾：</strong>寵物認養是終生的承諾，請勿因搬家、結婚等因素棄養</li>
                        <li><strong>聯絡義務：</strong>認養後請定期回報動物狀況，接受必要的追蹤訪問</li>
                        <li><strong>法律責任：</strong>若有虐待或棄養行為，將依法追究相關責任</li>
                    </ul>
                </div>

                <!-- 表單操作按鈕 -->
                <div class="form-actions">
                    <a href="/adoption/detail/{{ animal.animal_id }}/" 
                       class="btn btn-outline" 
                       style="margin-right: 10px;">取消</a>
                    <button type="submit" class="btn btn-success">
                        📤 提交申請
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // 表單驗證
        document.querySelector('form').addEventListener('submit', function(e) {
            const required = document.querySelectorAll('[required]');
            let hasError = false;
            
            required.forEach(field => {
                if (!field.value.trim()) {
                    field.style.borderColor = '#dc3545';
                    hasError = true;
                } else {
                    field.style.borderColor = '#ced4da';
                }
            });
            
            if (hasError) {
                e.preventDefault();
                alert('請填寫所有必填欄位');
                return false;
            }
            
            // 確認提交
            if (!confirm('確定要提交認養申請嗎？提交後將無法修改。')) {
                e.preventDefault();
                return false;
            }
        });

        // 電話號碼格式化
        document.getElementById('applicant_phone').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length > 10) value = value.substring(0, 10);
            e.target.value = value;
        });
    </script>
</body>
</html>
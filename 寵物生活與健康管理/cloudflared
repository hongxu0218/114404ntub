# Cloudflare Tunnel å®Œæ•´è¨­å®šæŒ‡å—

## ğŸ¯ ç›®æ¨™
è®“ `https://pawday114404.duckdns.org` è‡ªå‹•ç²å¾— HTTPSï¼Œç„¡éœ€è¤‡é›œè¨­å®š

## ğŸ“‹ å‰ç½®æº–å‚™
- âœ… ç¢ºä¿ Django æ‡‰ç”¨åœ¨ `localhost:8000` é‹è¡Œ
- âœ… ç¢ºä¿æ‚¨æœ‰ Cloudflare å¸³è™Ÿï¼ˆå…è²»ï¼‰

## ğŸš€ Step 1: ä¸‹è¼‰ cloudflared

### åœ¨ PowerShell ä¸­åŸ·è¡Œï¼ˆä»¥ç®¡ç†å“¡èº«åˆ†ï¼‰ï¼š
```powershell
# ä¸‹è¼‰ cloudflared
Invoke-WebRequest -Uri "https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-windows-amd64.exe" -OutFile "C:\cloudflared.exe"

# é©—è­‰ä¸‹è¼‰æˆåŠŸ
C:\cloudflared.exe --version
```

## ğŸ” Step 2: ç™»å…¥ Cloudflare

```powershell
# ç™»å…¥æ‚¨çš„ Cloudflare å¸³è™Ÿ
C:\cloudflared.exe tunnel login
```

**é€™æœƒé–‹å•Ÿç€è¦½å™¨**ï¼Œè«‹ï¼š
1. é¸æ“‡æ‚¨æƒ³è¦çš„ç¶²åŸŸï¼ˆå¯ä»¥é¸ä»»æ„ç¶²åŸŸï¼Œæˆ‘å€‘ç¨å¾Œæœƒæ”¹ï¼‰
2. æˆæ¬Š cloudflared å­˜å–

## ğŸ”§ Step 3: å‰µå»º Tunnel

```powershell
# å‰µå»ºåç‚º pawday-tunnel çš„ tunnel
C:\cloudflared.exe tunnel create pawday-tunnel
```

**æˆåŠŸå¾Œæœƒé¡¯ç¤º**ï¼š
```
Created tunnel pawday-tunnel with id: [é•·ä¸²ID]
```

## ğŸŒ Step 4: è¨­å®š DNS è¨˜éŒ„

```powershell
# å°‡æ‚¨çš„ DuckDNS ç¶²åŸŸé€£æ¥åˆ° tunnel
C:\cloudflared.exe tunnel route dns pawday-tunnel pawday114404.duckdns.org
```

**æ³¨æ„**ï¼šé€™æ­¥é©Ÿæœƒè‡ªå‹•åœ¨ Cloudflare ä¸­å‰µå»º DNS è¨˜éŒ„

## ğŸ“ Step 5: å‰µå»ºè¨­å®šæª”

### æ‰¾åˆ°è¨­å®šæª”ä½ç½®ï¼š
```
C:\Users\[æ‚¨çš„ä½¿ç”¨è€…åç¨±]\.cloudflared\
```

### å‰µå»º `config.yml` æª”æ¡ˆï¼š
åœ¨ä¸Šè¿°è·¯å¾‘ä¸­å‰µå»º `config.yml`ï¼Œå…§å®¹å¦‚ä¸‹ï¼š

```yaml
tunnel: pawday-tunnel
credentials-file: C:\Users\[æ‚¨çš„ä½¿ç”¨è€…åç¨±]\.cloudflared\[tunnel-id].json

ingress:
  - hostname: pawday114404.duckdns.org
    service: http://localhost:8000
  - service: http_status:404
```

**é‡è¦**ï¼š
- å°‡ `[æ‚¨çš„ä½¿ç”¨è€…åç¨±]` æ›¿æ›ç‚ºå¯¦éš›çš„ä½¿ç”¨è€…åç¨±
- å°‡ `[tunnel-id]` æ›¿æ›ç‚º Step 3 é¡¯ç¤ºçš„å¯¦éš› ID

## âš¡ Step 6: å•Ÿå‹• Tunnel

```powershell
# å•Ÿå‹• tunnel
C:\cloudflared.exe tunnel run pawday-tunnel
```

**æˆåŠŸå¾Œæœƒé¡¯ç¤º**ï¼š
```
2025-06-01T10:00:00Z INF Connection 0 connected
```

## ğŸ Step 7: ä¿®æ”¹ Django è¨­å®š

### æ›´æ–° `settings.py`ï¼š
```python
# settings.py

# å…è¨±çš„ä¸»æ©Ÿ
ALLOWED_HOSTS = [
    'pawday114404.duckdns.org',
    '127.0.0.1',
    'localhost',
]

# Cloudflare Tunnel HTTPS è¨­å®š
SECURE_PROXY_SSL_HEADER = ('HTTP_CF_VISITOR', '{"scheme":"https"}')
SECURE_SSL_REDIRECT = True
SESSION_COOKIE_SECURE = True
CSRF_COOKIE_SECURE = True

# allauth HTTPS è¨­å®š
ACCOUNT_DEFAULT_HTTP_PROTOCOL = "https"

# ä¿¡ä»» Cloudflare IP
USE_X_FORWARDED_HOST = True
USE_X_FORWARDED_PORT = True
```

## ğŸ”„ Step 8: é‡æ–°å•Ÿå‹• Django

```powershell
# åœ¨å¦ä¸€å€‹ PowerShell è¦–çª—ä¸­
cd "D:\æ‚¨çš„å°ˆæ¡ˆè·¯å¾‘\petproject"
python manage.py runserver 0.0.0.0:8000
```

## âœ… Step 9: æ¸¬è©¦ HTTPS

åœ¨ç€è¦½å™¨ä¸­å‰å¾€ï¼š
```
https://pawday114404.duckdns.org
```

**æ‡‰è©²æœƒçœ‹åˆ°**ï¼š
- ğŸ”’ ç¶ è‰²é–é ­ï¼ˆå®‰å…¨é€£ç·šï¼‰
- âš¡ æ›´å¿«çš„è¼‰å…¥é€Ÿåº¦
- ğŸ›¡ï¸ Cloudflare ä¿è­·

---

## ğŸ”§ è¨­å®šé–‹æ©Ÿè‡ªå‹•å•Ÿå‹•

### æ–¹æ³• 1: å®‰è£ç‚º Windows æœå‹™
```powershell
# ä»¥ç®¡ç†å“¡èº«åˆ†åŸ·è¡Œ
C:\cloudflared.exe service install
```

### æ–¹æ³• 2: å‰µå»ºå•Ÿå‹•è…³æœ¬
å‰µå»º `start_pawday.bat`ï¼š
```batch
@echo off
start "Django" cmd /k "cd /d D:\æ‚¨çš„å°ˆæ¡ˆè·¯å¾‘\petproject && python manage.py runserver 0.0.0.0:8000"
start "Cloudflare Tunnel" cmd /k "C:\cloudflared.exe tunnel run pawday-tunnel"
```

---

## ğŸ†˜ æ•…éšœæ’é™¤

### å•é¡Œ 1: tunnel ç„¡æ³•é€£æ¥
```powershell
# æª¢æŸ¥è¨­å®šæª”
type C:\Users\%USERNAME%\.cloudflared\config.yml

# æª¢æŸ¥ tunnel ç‹€æ…‹
C:\cloudflared.exe tunnel list
```

### å•é¡Œ 2: Django 500 éŒ¯èª¤
æª¢æŸ¥ `ALLOWED_HOSTS` è¨­å®šï¼š
```python
ALLOWED_HOSTS = [
    'pawday114404.duckdns.org',  # ç¢ºä¿åŒ…å«é€™å€‹
    '127.0.0.1',
    'localhost',
]
```

### å•é¡Œ 3: éœæ…‹æª”æ¡ˆç„¡æ³•è¼‰å…¥
```python
# settings.py
STATIC_URL = '/static/'
STATIC_ROOT = BASE_DIR / 'staticfiles'

# åŸ·è¡Œ
python manage.py collectstatic
```

### å•é¡Œ 4: æª¢æŸ¥ tunnel æ—¥èªŒ
```powershell
# æŸ¥çœ‹è©³ç´°æ—¥èªŒ
C:\cloudflared.exe tunnel run pawday-tunnel --loglevel debug
```

---

## ğŸ‰ å®Œæˆæª¢æŸ¥æ¸…å–®

å®Œæˆå¾Œï¼Œæ‚¨æ‡‰è©²èƒ½å¤ ï¼š
- [ ] è¨ªå• `https://pawday114404.duckdns.org` 
- [ ] çœ‹åˆ°ç¶ è‰²é–é ­ ğŸ”’
- [ ] Django Admin æ­£å¸¸é‹ä½œ
- [ ] éœæ…‹æª”æ¡ˆæ­£å¸¸è¼‰å…¥
- [ ] Google ç™»å…¥åŠŸèƒ½æ­£å¸¸
- [ ] å¯µç‰©è³‡æ–™æ­£å¸¸é¡¯ç¤º

---

## ğŸ’¡ å„ªé»ç¸½çµ

âœ… **å®Œå…¨å…è²»** - Cloudflare Tunnel å…è²»  
âœ… **è‡ªå‹• SSL** - ç„¡éœ€æ‰‹å‹•è¨­å®šè­‰æ›¸  
âœ… **è‡ªå‹•æ›´æ–°** - SSL è­‰æ›¸è‡ªå‹•çºŒæœŸ  
âœ… **ç„¡éœ€é–‹ port** - ä¸éœ€è¦è¨­å®šè·¯ç”±å™¨  
âœ… **DDoS é˜²è­·** - Cloudflare è‡ªå‹•é˜²è­·  
âœ… **CDN åŠ é€Ÿ** - å…¨çƒç¯€é»åŠ é€Ÿ  
âœ… **ç°¡å–®ç¶­è­·** - è¨­å®šä¸€æ¬¡å³å¯  

æ‚¨çš„å¯µç‰©é†«ç™‚ç³»çµ±ç¾åœ¨å°‡æ“æœ‰ä¼æ¥­ç´šçš„å®‰å…¨æ€§å’Œæ•ˆèƒ½ï¼ğŸš€
